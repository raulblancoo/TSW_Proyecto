<div th:fragment="expensesFormFields" class="max-w-xl mx-auto p-6">
    <form id="paymentForm" th:action="@{/group/expenses/create/{groupId}(groupId=${group.id})}" method="post"
          th:object="${expense}">
        <div class="mb-4">
            <label for="payer_select" class="block text-sm font-medium text-gray-700">PAGADO POR</label>
            <select required id="payer_select" field="*{originUserId}" name="originUserId"
                    class="block py-2 px-0 w-full text-base text-slate-700 bg-transparent border-0 border-b-2 border-slate-400 focus:outline-none focus:ring-0 focus:border-sky-500 peer">
                <th:block th:each="user : ${users}">
                    <!-- Mostrar nombre y apellido en una sola opción -->
                    <option th:value="${user.id}" th:text="${user.name + ' ' + user.surname}"></option>
                </th:block>
            </select>
        </div>

        <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700">PARTICIPANTES</label>
            <div class="grid grid-cols-3 gap-2">
                <div th:each="user : ${users}">
                    <div class="flex items-center">
                        <input type="checkbox" name="destinationUsers" th:value="${user.id}"
                               class="text-sky-500 border-slate-400 focus:ring-0 focus:border-sky-500">
                        <label th:for="${'user_' + user.id}" class="ml-2 text-slate-700 whitespace-nowrap"
                               th:text="${user.name + ' ' + user.surname}"></label>
                    </div>
                </div>
            </div>
        </div>


        <div class="mb-4">
            <label for="payment_concept" class="block text-sm font-medium text-gray-700">CONCEPTO DEL PAGO</label>
            <input type="text" id="payment_concept" field="*{name}" name="name"
                   class="block py-2 px-0 w-full text-sm text-slate-700 bg-transparent border-0 border-b-2 border-slate-400 appearance-none focus:outline-none focus:ring-0 focus:border-sky-500 peer"
                   placeholder="Escriba un concepto" required/>
        </div>

        <div class="mb-4">
            <label for="payment_amount" class="block text-sm font-medium text-gray-700 mb-1">CANTIDAD</label>
            <div class="flex items-center">
                <input type="number" name="amount" id="payment_amount" field="*{amount}"
                       class="py-2 px-0 w-40 text-sm text-slate-700 bg-transparent border-0 border-b-2 border-slate-400 appearance-none focus:outline-none focus:ring-0 focus:border-sky-500 peer"
                       placeholder="Introduzca la cantidad" required/>
                <div class="ml-2 flex-shrink-0">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" class="w-6 h-6 text-gray-700">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M14.25 7.756a4.5 4.5 0 1 0 0 8.488M7.5 10.5h5.25m-5.25 3h5.25M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                    </svg>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <label for="divided_payment" class="block text-sm font-medium text-gray-700">DIVISIÓN</label>
            <select required id="divided_payment"
                    class="block py-2 px-0 w-full text-base text-slate-700 bg-transparent border-0 border-b-2 border-slate-400 focus:outline-none focus:ring-0 focus:border-sky-500 peer"
                    name="share_method" field="*{share_method}">
                <option hidden selected></option>
                <option th:each="expenseMethod : ${expenseMethods}"
                        th:value="${expenseMethod.getCode()}"
                        th:text="${expenseMethod.getCode()}">
                </option>
            </select>
        </div>

        <!-- Div oculto que contiene el formulario adicional -->
        <div id="userValuesForm" class="mt-4 space-y-2">
            <label class="block text-sm font-medium text-gray-700">Asigna un valor para cada usuario</label>
            <th:block th:each="user : ${users}">
                <div class="flex items-center">
                    <span th:text="${user.name} + ' ' + ${user.surname}" class="mr-4 text-slate-700"></span>
                    <input type="number" name="userValues[${user.id}]" min="0" step="0.01"
                           class="py-2 px-2 w-32 text-sm text-slate-700 bg-transparent border border-slate-400 rounded focus:outline-none focus:ring-1 focus:ring-sky-500"
                           placeholder="Valor">
                </div>
            </th:block>
        </div>

        <!-- Modal Footer -->
        <div class="flex justify-end p-5 border-t border-gray-200">
            <button type="submit"
                    class="bg-sky-500 text-white px-4 py-2 rounded-lg hover:bg-sky-700 focus:outline-none focus:ring-4 focus:ring-sky-300">
                Guardar
            </button>
        </div>
    </form>
</div>

<script>
    document.getElementById("paymentForm").addEventListener("submit", function(event) {
        // Evita el comportamiento predeterminado del formulario (reenvío y borrado de campos)
        event.preventDefault();

        // Aquí puedes agregar lógica para mantener el estado de los campos, si es necesario
        // Por ejemplo, podrías recoger los valores de los correos electrónicos y almacenarlos para restaurarlos

        // Llamar a la función para enviar el formulario usando AJAX, si es necesario
        // Si no es necesario usar AJAX, puedes omitir el preventDefault y dejar que el formulario se envíe.
        this.submit();
    });
</script>